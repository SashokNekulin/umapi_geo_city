# umapi_geo_city

======

Nodejs модуль umapi_geo_city это инструмент для работы с объектами карты. Первичный вариант использования - это создание набора связанных с картой объектов (т.е. каждый из них имеет свою широту, долготу и данные), за которым следуют запросы для поиска объектов в заданной области ( прямоугольная область / круглая область).
Модуль обернут реализаций красно-черных двоичных деревьев поиска с использованием алгоритма z-кривой для преобразования координат 2D-плоскости в скалярный индекс (и использования этого индекса в качестве числового ключа в основе красно-черного дерева).

Таким образом, операция поиска не должна проходить через весь список, но мы исключаем множество элементов, для которых мы заранее знаем, что нам не нужно их рассматривать на основе предоставленных критериев поиска.

Поэтому при использовании сотен, тысяч или даже большего количества объектов в вашем картографическом приложении и при возникновении проблем с производительностью эта библиотека может оказаться очень полезной.

Не требует базы данных. В составе модуля уже имеется подготовленный список городов России.

## Установка
```
npm install umapi_geo_city
```

## Использование

```js
var GEO = require('umapi_geo_city')

// Чтобы создать новый пустой набор (дерево), выполните:
var set = new GEO()

// Загрузить в текущий набор города России
set.loadCityList()

// Поиск ближайших объектов в радиусе 30 км. от заданных координат
console.log('CIRCLE', set.getListCircle(54.707, 20.507, 30))

// Получить список объектов в прямоугольнике, определяемом двумя координатами
console.log('POLIGON', set.getListPoligon(54.707, 20.507, 54.001, 20.001))

// Получить расстояние в Км. между двумя точками на карте
console.log('DISTANCE', set.distance(54.707, 20.507, 54.001, 20.001))

```

## Загрузить в текущий набор объектов города России:

```js
set.loadCityList()
```

## Получить текущий набор объектов:

```js
console.log(set.getGeoList())
```

## Очистить текущий набор объектов:

```js
set.clearGeoList()
```

## Добавить обьект в текущий набор:

Чтобы добавить обьект, в файл set, используйте addGeoList()функцию. Каждый вставленный обьект должен иметь широту lat, долготу lng все остальные поля на ваше усмотрение.
Для массовой вставки вы можете передать массив из вышеупомянутых объектов, они будут вставляться последовательно.
```js
set.addGeoList({
    lat:67.6381525,
    lng:53.0069336,
    data:{
        index:166000,
        region:"Ненецкий Автономный округ",
        area: "",
        city: "Нарьян-Мар",
        UTC: "UTC+3",
        federal: "Северо-Западный Федеральный округ",
        population:21296
    }
})
// Или массив
set.addGeoList([
    {
        lat:67.6381525,
        lng:53.0069336,
        data:{
            index:166000,
            region:"Ненецкий Автономный округ",
            area: "",
            city: "Нарьян-Мар",
            UTC: "UTC+3",
            federal: "Северо-Западный Федеральный округ",
            population:21296
        }
    },
])
```

## Получить список объектов в прямоугольнике, определяемом двумя координатами:

Аргументы рассматриваются как две диагональные вершины прямоугольника

```js
const
    // Широта координаты первой вершины
    latOne = 54.707,
    // Долгота координаты первой вершины
    lngOne = 20.507,
    // Широта координаты второй вершины
    latTwo =  54.001,
    // Долгота координаты второй вершины
    lngTwo =  20.001

console.log(set.getListPoligon(latOne, lngOne, latTwo, lngTwo))
```

## Получить список обьектов в радиусе круга:

```js
const
    // Широта координаты центра
    lat = 54.707,
    // Долгота координаты центра
    lng = 20.507,
    // Радиус круга Км.
    radiusКm =  60

console.log(set.getListCircle(lat, lng, radiusКm))
```

## Получить расстояние между двумя координатами в Км.:

```js
const
    // Широта первой координаты
    latOne = 54.707,
    // Долгота первой координаты
    lngOne = 20.507,
    // Широта второй координаты
    latTwo =  54.001,
    // Долгота второй координаты
    lngTwo =  20.001

console.log(set.distance(latOne, lngOne, latTwo, lngTwo))
```

## Автор

[Alexandr Nikulin](https://github.com/SashokNekulin/), e-mail: [nekulin@mail.ru](mailto:nekulin@mail.ru)
